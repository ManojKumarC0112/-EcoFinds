<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <title>Shopping Cart - EcoFinds</title> <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet"/> <style> .navbar-brand { font-weight: bold; color: #198754 !important; } .cart-badge { background:#dc3545; color:#fff; border-radius:50%; padding:2px 6px; font-size:10px; position:absolute; top:-5px; right:-5px; } .cart-item { border-bottom:1px solid #dee2e6; padding:1rem 0; } .cart-item:last-child { border-bottom:none; } .product-image { width:80px; height:80px; object-fit:cover; border-radius:8px; cursor:pointer; } .qty-btn { width:32px; height:32px; display:inline-flex; align-items:center; justify-content:center; } .cart-summary { background:#f8f9fa; border-radius:8px; padding:1.5rem; } .btn-purchase { background:#198754; border-color:#198754; font-size:1.05rem; padding:10px 24px; } </style> </head> <body> <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm"> <div class="container"> <a class="navbar-brand" href="index.html"><i class="bi bi-recycle"></i> EcoFinds</a> <div class="ms-auto position-relative"> <a class="nav-link" href="cart.html"><i class="bi bi-cart3"></i> Cart <span id="cartBadge" class="cart-badge" style="display:none">0</span></a> </div> </div> </nav> <div class="container py-4"> <div class="d-flex align-items-center justify-content-between mb-3"> <h3 class="mb-0"><i class="bi bi-cart3 me-2"></i>Shopping Cart</h3> <a href="index.html" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Continue Shopping</a> </div>
text
<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-body" id="cartArea">
        <div class="text-center py-5" id="loading">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="text-muted mt-2 mb-0">Loading your cart…</p>
        </div>
        <div id="emptyState" class="text-center py-5" style="display:none;">
          <i class="bi bi-cart-x display-1"></i>
          <h5 class="mt-3">Your cart is empty</h5>
          <p class="text-muted mb-3">Add items from the listings page.</p>
          <a href="index.html" class="btn btn-primary"><i class="bi bi-shop"></i> Browse Products</a>
        </div>
        <div id="items"></div>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="cart-summary" id="summary" style="display:none;">
      <h5 class="mb-3">Order Summary</h5>
      <div class="d-flex justify-content-between mb-2">
        <span>Items (<span id="sumQty">0</span>)</span>
        <span id="sumSubtotal">$0.00</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span>Shipping</span>
        <span class="text-success">FREE</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span>Tax (8%)</span>
        <span id="sumTax">$0.00</span>
      </div>
      <hr/>
      <div class="d-flex justify-content-between">
        <strong>Total</strong>
        <strong id="sumTotal">$0.00</strong>
      </div>
      <button class="btn btn-purchase w-100 mt-3" onclick="purchaseAll()" id="purchaseBtn"><i class="bi bi-credit-card"></i> Purchase All</button>
      <button class="btn btn-outline-danger w-100 mt-2" onclick="clearCart()"><i class="bi bi-trash"></i> Clear Cart</button>
    </div>

    <div class="card mt-4" id="impact" style="display:none;">
      <div class="card-body text-center">
        <i class="bi bi-tree text-success display-6"></i>
        <h6 class="mt-2">Environmental Impact</h6>
        <p class="small text-muted mb-0">Buying second-hand reduces waste and carbon footprint. Thank you!</p>
      </div>
    </div>
  </div>
</div>
</div> <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> <script src="js/common.js"></script> <script> let rawCart = []; let grouped = {}; let indexByProduct = {}; function groupCart(items) { const map = {}; for (const it of items) { const key = it.product_id; if (!map[key]) map[key] = { product_id: it.product_id, title: it.title, price: parseFloat(it.price), image_url: it.image_url, qty: 0 }; map[key].qty += 1; } return map; } function buildIndex(items){ const map = {}; for (const it of items) { if (!map[it.product_id]) map[it.product_id] = []; map[it.product_id].push(it.cart_item_id); } return map; } async function loadCart() { const u = getCurrentUser(); if (!u) { window.location.href = 'login.html'; return; } try { const d = await apiCall(`/cart?user_id=${u.id}`); rawCart = d.results || []; indexByProduct = buildIndex(rawCart); grouped = groupCart(rawCart); renderCart(); updateCartBadge(); } catch (e) { document.getElementById('loading').innerHTML = '<div class="text-danger">Failed to load cart</div>'; } } function renderCart() { const loading = document.getElementById('loading'); const empty = document.getElementById('emptyState'); const itemsDiv = document.getElementById('items'); const summary = document.getElementById('summary'); const impact = document.getElementById('impact'); loading.style.display = 'none'; const entries = Object.values(grouped); if (!entries.length) { empty.style.display = 'block'; itemsDiv.innerHTML = ''; summary.style.display = 'none'; impact.style.display = 'none'; updateSummary(); return; } empty.style.display = 'none'; summary.style.display = 'block'; impact.style.display = 'block'; itemsDiv.innerHTML = entries.map(x => ` <div class="cart-item"> <div class="row align-items-center"> <div class="col-md-2 text-center"> <img src="${x.image_url}" class="product-image" alt="${x.title}" onclick="openProduct(${x.product_id})"> </div> <div class="col-md-6"> <div class="fw-semibold">${x.title}</div> <div class="text-muted small">$${x.price.toFixed(2)}</div> </div> <div class="col-md-2 text-center"> <div class="btn-group" role="group"> <button class="btn btn-outline-secondary qty-btn" onclick="decQty(${x.product_id})">−</button> <button class="btn btn-light qty-btn" disabled>${x.qty}</button> <button class="btn btn-outline-secondary qty-btn" onclick="incQty(${x.product_id})">+</button> </div> </div> <div class="col-md-2 text-end"> <div class="h6 mb-0">$${(x.price * x.qty).toFixed(2)}</div> </div> </div> </div> `).join(''); updateSummary(); } function updateSummary() { const list = Object.values(grouped); const qty = list.reduce((s, x) => s + x.qty, 0); const subtotal = list.reduce((s, x) => s + x.price * x.qty, 0); const tax = subtotal * 0.08; const total = subtotal + tax; document.getElementById('sumQty').textContent = qty; document.getElementById('sumSubtotal').textContent = `$${subtotal.toFixed(2)}`; document.getElementById('sumTax').textContent = `$${tax.toFixed(2)}`; document.getElementById('sumTotal').textContent = `$${total.toFixed(2)}`; } async function incQty(product_id) { const u = getCurrentUser(); if (!u) { showToast('Login first','warning'); return; } try { await apiCall('/cart/add', { method: 'POST', body: JSON.stringify({ user_id: u.id, product_id }) }); await loadCart(); } catch (e) { showToast('Failed to add item', 'error'); } } async function decQty(product_id) { const ids = indexByProduct[product_id] || []; if (!ids.length) return; const rowId = ids.pop(); try { await apiCall(`/cart/item/${rowId}`, { method: 'DELETE' }); await loadCart(); } catch (e) { showToast('Failed to remove item', 'error'); } } async function clearCart() { const u = getCurrentUser(); if (!u) { showToast('Login first','warning'); return; } if (!confirm('Clear all items from your cart?')) return; try { await apiCall(`/cart/clear?user_id=${u.id}`, { method: 'DELETE' }); await loadCart(); updateCartBadge(); showToast('Cart cleared','success'); } catch (e) { showToast('Failed to clear cart','error'); } } async function purchaseAll() { const u = getCurrentUser(); if (!u) { showToast('Login first','warning'); return; } const btn = document.getElementById('purchaseBtn'); btn.disabled = true; btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...'; try { await apiCall('/purchase', { method: 'POST', body: JSON.stringify({ user_id: u.id }) }); showToast('Purchase successful!', 'success'); await loadCart(); updateCartBadge(); setTimeout(()=> window.location.href='purchases.html', 800); } catch (e) { showToast('Purchase failed', 'error'); } finally { btn.disabled = false; btn.innerHTML = '<i class="bi bi-credit-card"></i> Purchase All'; } } function openProduct(id){ window.location.href = `product.html?id=${id}`; } document.addEventListener('DOMContentLoaded', () => { initializePage(); loadCart(); }); </script> </body> </html>