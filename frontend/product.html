 <html lang="en"> 
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Product - EcoFinds</title> 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet"> 
  <style> 
    .navbar-brand{font-weight:bold;color:#198754!important} 
    .thumb{width:100%;height:320px;object-fit:cover;border-radius:12px} 
  </style> 
</head> 
<body> 
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm"> 
    <div class="container"> 
      <a class="navbar-brand" href="index.html"><i class="bi bi-recycle"></i> EcoFinds</a> 
      <div class="ms-auto"> 
        <a class="nav-link d-inline" href="cart.html"><i class="bi bi-cart3"></i> Cart <span id="cartBadge" class="badge bg-danger" style="display:none">0</span></a> 
      </div> 
    </div> 
  </nav> 
  <div class="container py-4" id="content"> 
    <div class="text-center py-5 text-muted">Loading product...</div> 
  </div> 
  <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div> 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> 
  <script src="js/common.js"></script> 
  <script> 
    async function loadProduct(){ 
      const id = new URLSearchParams(location.search).get('id'); 
      if(!id){ 
        document.getElementById('content').innerHTML='<div class="text-center text-danger py-5">Invalid product</div>'; 
        return; 
      } 
      try{ 
        const d = await apiCall(`/products/${id}`); 
        const p = d.product; 
        updateCartBadge(); 
        document.getElementById('content').innerHTML = ` 
          <div class='row g-4'> 
            <div class='col-lg-6'> 
              <img src='${p.image_url}' class='thumb' alt='${p.title}'> 
            </div> 
            <div class='col-lg-6'> 
              <h3>${p.title}</h3> 
              <div class='text-muted mb-2'>${p.category}</div> 
              <div class='h4 text-success'>$${p.price}</div> 
              <p class='mt-3'>${p.description||'No description'}</p> 
              <div class='d-flex gap-2 mt-3'> 
                <button class='btn btn-primary' onclick='addToCart(${p.id})'><i class="bi bi-cart-plus"></i> Add to Cart</button> 
                <a href='index.html' class='btn btn-outline-secondary'>Back</a> 
              </div> 
            </div> 
          </div>`; 
      }catch(e){ 
        document.getElementById('content').innerHTML='<div class="text-center text-danger py-5">Product not found</div>'; 
      } 
    } 
    
    async function addToCart(pid){ 
      const u = getCurrentUser(); 
      if(!u){ 
        showToast('Login first','warning'); 
        return; 
      } 
      try{ 
        await apiCall('/cart/add',{method:'POST',body:JSON.stringify({user_id:u.id, product_id:pid})}); 
        showToast('Added to cart','success'); 
        updateCartBadge(); 
      } catch(e){ 
        showToast(e.message,'error'); 
      } 
    } 
    
    document.addEventListener('DOMContentLoaded', loadProduct); 
  </script> 
</body> 
</html>
